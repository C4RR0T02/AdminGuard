#TRUSTED 89ee0f17e505f70acfb2193a71bf7d5df1ef5e6d3f4bbb510b9d52a9a719b427af79ce838a8ffa45afe5b816e0cc902ab9c2835cce169e7be57705e76ec52f637843edc66febab79f9670d81589833358827bc41356b5e24f85ade8885384ed14b7001633f5519aab69f69c68752f7bab0b8aa4354f19c26b6de6ac6ff9afdbf3da0337ffc608347e69c08edd0a27784423e54259c28a590fa8d808b7aacb5874efb8065cf6263b6e779c4803f55559c5ed4d4f64aa559007e3b93ed50299428d4c26d6ebbe1f4e9077764f6f572cff63058944f29af96566f92ae15bd1c0ea84807f81b4297b0cb91f42b883bd3a95c2bdf3394615eb0620e6fd224ea22cf740c929520f67d7167c8902df4683154ed7ceab3fe742f9bc8e99c7fef2afd3d86cc2100b5d8075bcd1e725c4c62996d3dfb2639c5b6bcf02193037c60a5bb6ba959e156835fe8a5fca0c0999d516e2c35bddbbabf96b32b51ed895d365efcdd88488802392c35e791f5639fdfd6ceec35f834e704c1c8c9ba417657eb6b4c1afded657d8d5eb7c957dff764c1863cb08676d5c98759881cbac7fd19959fa568be5c7554daad553d9dba58ca4747d4951ecee779a31c9cc55d3a9d3f803626ec166fb9899c8f38b7979192088aeba3abda4023d53ed719384bb547e8c06fdbee12aee0a88d09b1ddcb99dba51158adc9bf93b198417a53892192af0449ee32a537
#TRUST-RSA-SHA256 9466cb0f74aa852ffbc548b5ea59c08fe5967abed081c67d92a8ede783bc264c2752977b2e11929b64855f6fc65a2202a95152fa90f121190978f85ae537637a70d8cd5c5aeda73d8891f237887822b951b6b20be36c6441dfba864ccfb06716be1a2f0dca13e21f37b69e04ea7e0c1d18754cda1264a6b3cd512a6a1056db7371141bcbbf6b39fa539f06c32ae0c590778974cd95a388701b870417dbf96744a16ffec9f04d68b976b6d7a12dfeb7b032a78ec1d0230ca436fa481f4353715cb2523333c4c34197fd5ddb90d0f016d6d69ed5e2c2137bf57275e15170c9ddf533c3f23ef50071c7e4d721cf5bb058209d12bb811933777f2ed3a1e2641532be1eca6d529382e0b00ff01761f44b5be113acb1bd43c4e00d1d118642a299da6bb37add6c5baf2050d413a7d67d1cd1156a2ec5d1c31e345ae1154d858395e158032427fdbe7648b82cb64754f7a6c66d805a675305b9ed0bcbd49a64236f56631530c5657505cd69d6afe1267601c9d971a98d7efa7715a284f3e323c110fac43918d5b793e1a1126dd3e0e423a532dc977bda7c7943251016c17981f944052d8d59bfa8b536a9a99c07184192d68b3603b9d5f9c466b0025931d01fc18c172672cea6dd86de41e5b398dfb14a7744aab4c9119322a55fb7a3574cabf02240106c4540a008e8439b9d98827cd7d543a7328c07fd935018d7ec2effeb77d6e260
#
# This script is Copyright (C) 2004-2023 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.1 $
# $Date: 2023/09/15 $
#
# Description : This document implements the security configuration as recommended by the
#               DISA Microsoft Windows Server 2022 v1r3 STIG.
#
#<ui_metadata>
#<display_name>DISA Windows Server 2022 STIG v1r3</display_name>
#<spec>
#  <type>DISA STIG</type>
#  <name>Windows Server 2022</name>
#  <version>1.3.0</version>
#  <link>https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Server_2022_V1R3_STIG.zip</link>
#</spec>
#<labels>windows_server_2022,update_20230227</labels>
#<benchmark_refs>CAT,CCE,CCI,DISA_Benchmark,Group-ID,Rule-ID,STIG-ID,STIG-Legacy,Vuln-ID</benchmark_refs>
#<variables>
#  <variable>
#    <name>LEGAL_CAPTION_TEXT</name>
#    <default>DoD Notice and Consent Banner</default>
#    <description>Logon Window Caption</description>
#    <info>This is the window caption text for the login warning a user receives when logging onto the system.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>LEGAL_NOTICE_TEXT</name>
#    <default>You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only.\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n-At any time, the USG may inspect and seize data stored on this IS.\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.</default>
#    <description>Logon Window Text</description>
#    <info>This is the window text for the login warning a user receives when logging onto the system.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>PLATFORM_VERSION</name>
#    <default>2022</default>
#    <description>Windows Server Version</description>
#    <info>Windows Server Version</info>
#    <value_type>INTEGER</value_type>
#  </variable>
#  <variable>
#    <name>PASSWORD_HISTORY</name>
#    <default>[24..MAX]</default>
#    <description>Password history value</description>
#    <info>Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Enforce password history</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MAXIMUM_PASSWORD_AGE</name>
#    <default>[1..60]</default>
#    <description>Maximum password age value</description>
#    <info>Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Maximum password age</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MINIMUM_PASSWORD_AGE</name>
#    <default>[1..MAX]</default>
#    <description>Minimum password age value</description>
#    <info>Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Minimum password age</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MINIMUM_PASSWORD_LENGTH</name>
#    <default>[14..MAX]</default>
#    <description>Minimum password length value</description>
#    <info>Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Minimum password length</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MAN_SVC_ACCT</name>
#    <default>ServiceAccount</default>
#    <description>Manually-created service account name</description>
#    <info>Name of manually-created service account to be evaluated for WN22-00-000060.</info>
#    <value_type>WIN_ACCT</value_type>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Windows" version:"2">
<group_policy:"Microsoft Windows Server 2022">

<file_acl:"CDir">
  <user:"Administrators">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder, subfolders and files"
    acl_allow       : "change permissions" | "create files / write data" | "create folders / append data" | "delete" | "delete subfolder and files" | "full control" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "take ownership" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"System">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder, subfolders and files"
    acl_allow       : "change permissions" | "create files / write data" | "create folders / append data" | "delete" | "delete subfolder and files" | "full control" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "take ownership" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"Users">
    acl_inheritance : "not inherited"
    acl_apply       : "this folder only"
    acl_allow       : "create folders / append data" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "traverse folder / execute file"
  </user>

  <user:"Users">
    acl_inheritance : "not inherited"
    acl_apply       : "files only"
    acl_allow       : "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "traverse folder / execute file"
  </user>

  <user:"Users">
    acl_inheritance : "not inherited"
    acl_apply       : "subfolders only"
    acl_allow       : "create files / write data" | "create folders / append data" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "traverse folder / execute file"
  </user>

  <user:"CREATOR OWNER">
    acl_inheritance : "not inherited"
    acl_apply       : "Subfolders and files only"
    acl_allow       : "change permissions" | "create files / write data" | "create folders / append data" | "delete" | "delete subfolder and files" | "full control" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "take ownership" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>
</file_acl>

<file_acl:"EventViewer">
  <user:"Administrators">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder only"
    acl_allow       : 'list folder / read data' | 'read attributes' | 'read extended attributes' | 'read permissions' | 'traverse folder / execute file'
  </user>

  <user:"System">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder only"
    acl_allow       : 'list folder / read data' | 'read attributes' | 'read extended attributes' | 'read permissions' | 'traverse folder / execute file'
  </user>

  <user:"ALL APPLICATION PACKAGES">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder only"
    acl_allow       : 'list folder / read data' | 'read attributes' | 'read extended attributes' | 'read permissions' | 'traverse folder / execute file'
  </user>

  <user:"ALL RESTRICTED APPLICATION PACKAGES">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder only"
    acl_allow       : 'list folder / read data' | 'read attributes' | 'read extended attributes' | 'read permissions' | 'traverse folder / execute file'
  </user>

  <user:"TrustedInstaller">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder only"
    acl_allow       : 'change permissions' | 'create files / write data' | 'create folders / append data' | 'delete' | 'delete subfolder and files' | 'full control' | 'list folder / read data' | 'read attributes' | 'read extended attributes' | 'read permissions' | 'take ownership' | 'traverse folder / execute file' | 'write attributes' | 'write extended attributes'
  </user>

  <user:"Users">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder only"
    acl_allow       : 'list folder / read data' | 'read attributes' | 'read extended attributes' | 'read permissions' | 'traverse folder / execute file'
  </user>
</file_acl>

<file_acl:"ProgramFiles">
  <user:"TrustedInstaller">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder and subfolders"
    acl_allow       : "change permissions" | "create files / write data" | "create folders / append data" | "delete" | "delete subfolder and files" | "full control" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "take ownership" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"Administrators">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder only"
    acl_allow       : "create files / write data" | "create folders / append data" | "delete" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"System">
    acl_inheritance : "not inherited"
    acl_apply       : "subfolders and files only"
    acl_allow       : "change permissions" | "create files / write data" | "create folders / append data" | "delete" | "delete subfolder and files" | "full control" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "take ownership" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"System">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder only"
    acl_allow       : "create files / write data" | "create folders / append data" | "delete" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"Users">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder, subfolders and files"
    acl_allow       : "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "traverse folder / execute file"
  </user>

  <user:"Administrators">
    acl_inheritance : "not inherited"
    acl_apply       : "subfolders and files only"
    acl_allow       : "change permissions" | "create files / write data" | "create folders / append data" | "delete" | "delete subfolder and files" | "full control" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "take ownership" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"CREATOR OWNER">
    acl_inheritance : "not inherited"
    acl_apply       : "Subfolders and files only"
    acl_allow       : "change permissions" | "create files / write data" | "create folders / append data" | "delete" | "delete subfolder and files" | "full control" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "take ownership" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"All APPLICATION PACKAGES">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder, subfolders and files"
    acl_allow       : "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "traverse folder / execute file"
  </user>

  <user:"All RESTRICTED APPLICATION PACKAGES">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder, subfolders and files"
    acl_allow       : "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "traverse folder / execute file"
  </user>
</file_acl>

<file_acl:"Windows">
  <user:"TrustedInstaller">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder and subfolders"
    acl_allow       : "change permissions" | "create files / write data" | "create folders / append data" | "delete" | "delete subfolder and files" | "full control" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "take ownership" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"Administrators">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder only"
    acl_allow       : "create files / write data" | "create folders / append data" | "delete" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"System">
    acl_inheritance : "not inherited"
    acl_apply       : "subfolders and files only"
    acl_allow       : "change permissions" | "create files / write data" | "create folders / append data" | "delete" | "delete subfolder and files" | "full control" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "take ownership" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"System">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder only"
    acl_allow       : "create files / write data" | "create folders / append data" | "delete" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"Users">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder, subfolders and files"
    acl_allow       : "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "traverse folder / execute file"
  </user>

  <user:"Administrators">
    acl_inheritance : "not inherited"
    acl_apply       : "subfolders and files only"
    acl_allow       : "change permissions" | "create files / write data" | "create folders / append data" | "delete" | "delete subfolder and files" | "full control" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "take ownership" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"CREATOR OWNER">
    acl_inheritance : "not inherited"
    acl_apply       : "Subfolders and files only"
    acl_allow       : "change permissions" | "create files / write data" | "create folders / append data" | "delete" | "delete subfolder and files" | "full control" | "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "take ownership" | "traverse folder / execute file" | "write attributes" | "write extended attributes"
  </user>

  <user:"All APPLICATION PACKAGES">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder, subfolders and files"
    acl_allow       : "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "traverse folder / execute file"
  </user>

  <user:"All RESTRICTED APPLICATION PACKAGES">
    acl_inheritance : "not inherited"
    acl_apply       : "This folder, subfolders and files"
    acl_allow       : "list folder / read data" | "read attributes" | "read extended attributes" | "read permissions" | "traverse folder / execute file"
  </user>
</file_acl>

<registry_acl:"HKLM_SECURITY">
  <user:"Administrators">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'read control' | 'write dac'
  </user>

  <user:"SYSTEM">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'create link' | 'create subkey' | 'delete' | 'enumerate subkeys' | 'full control' | 'notify' | 'query value' | 'read control' | 'set value' | 'write dac' | 'write owner'
  </user>
</registry_acl>

<registry_acl:"HKLM_SOFTWARE">
  <user:"Users">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'enumerate subkeys' | 'notify' | 'query value' | 'read control'
  </user>

  <user:"Administrators">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'create link' | 'create subkey' | 'delete' | 'enumerate subkeys' | 'full control' | 'notify' | 'query value' | 'read control' | 'set value' | 'write dac' | 'write owner'
  </user>

  <user:"SYSTEM">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'create link' | 'create subkey' | 'delete' | 'enumerate subkeys' | 'full control' | 'notify' | 'query value' | 'read control' | 'set value' | 'write dac' | 'write owner'
  </user>

  <user:"CREATOR OWNER">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'create link' | 'create subkey' | 'delete' | 'enumerate subkeys' | 'full control' | 'notify' | 'query value' | 'read control' | 'set value' | 'write dac' | 'write owner'
  </user>

  <user:"ALL APPLICATION PACKAGES">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'enumerate subkeys' | 'notify' | 'query value' | 'read control'
  </user>

  <user:"1-15-3-1024-1065365936-1281604716-3511738428-1654721687-432734479-3232135806-4053264122-3456934681">
    acl_inheritance : "not inherited"
    acl_apply       : "This key and subkeys"
    acl_allow       : 'enumerate subkeys' | 'notify' | 'query value' | 'read control'
  </user>
</registry_acl>

<registry_acl:"HKLM_SYSTEM">
  <user:"Users">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'enumerate subkeys' | 'notify' | 'query value' | 'read control'
  </user>

  <user:"Administrators">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'create link' | 'create subkey' | 'delete' | 'enumerate subkeys' | 'full control' | 'notify' | 'query value' | 'read control' | 'set value' | 'write dac' | 'write owner'
  </user>

  <user:"SYSTEM">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'create link' | 'create subkey' | 'delete' | 'enumerate subkeys' | 'full control' | 'notify' | 'query value' | 'read control' | 'set value' | 'write dac' | 'write owner'
  </user>

  <user:"CREATOR OWNER">
    acl_inheritance : "not inherited"
    acl_apply       : "subkeys only"
    acl_allow       : 'create link' | 'create subkey' | 'delete' | 'enumerate subkeys' | 'full control' | 'notify' | 'query value' | 'read control' | 'set value' | 'write dac' | 'write owner'
  </user>

  <user:"ALL APPLICATION PACKAGES">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'enumerate subkeys' | 'notify' | 'query value' | 'read control'
  </user>

  <user:"1-15-3-1024-1065365936-1281604716-3511738428-1654721687-432734479-3232135806-4053264122-3456934681">
    acl_inheritance : "not inherited"
    acl_apply       : "This key and subkeys"
    acl_allow       : 'enumerate subkeys' | 'notify' | 'query value' | 'read control'
  </user>
</registry_acl>

<registry_acl:"HKLM_SYSTEM_DOMAIN">
  <user:"Users">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'enumerate subkeys' | 'notify' | 'query value' | 'read control'
  </user>

  <user:"Administrators">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'create link' | 'create subkey' | 'delete' | 'enumerate subkeys' | 'full control' | 'notify' | 'query value' | 'read control' | 'set value' | 'write dac' | 'write owner'
  </user>

  <user:"SYSTEM">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'create link' | 'create subkey' | 'delete' | 'enumerate subkeys' | 'full control' | 'notify' | 'query value' | 'read control' | 'set value' | 'write dac' | 'write owner'
  </user>

  <user:"CREATOR OWNER">
    acl_inheritance : "not inherited"
    acl_apply       : "subkeys only"
    acl_allow       : 'create link' | 'create subkey' | 'delete' | 'enumerate subkeys' | 'full control' | 'notify' | 'query value' | 'read control' | 'set value' | 'write dac' | 'write owner'
  </user>

  <user:"ALL APPLICATION PACKAGES">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'enumerate subkeys' | 'notify' | 'query value' | 'read control'
  </user>

  <user:"Server Operators">
    acl_inheritance : "not inherited"
    acl_apply       : "this key and subkeys"
    acl_allow       : 'enumerate subkeys' | 'notify' | 'query value' | 'read control'
  </user>

  <user:"1-15-3-1024-1065365936-1281604716-3511738428-1654721687-432734479-3232135806-4053264122-3456934681">
    acl_inheritance : "not inherited"
    acl_apply       : "This key and subkeys"
    acl_allow       : 'enumerate subkeys' | 'notify' | 'query value' | 'read control'
  </user>
</registry_acl>

<if>
  <condition type:"AND">
    <custom_item>
      type	:	"REGISTRY_SETTING"
      description	:	"Windows Server 2022 is installed"
      value_type	:	"POLICY_TEXT"
      value_data	:	"^[a-zA-Z0-9\(\)\s]*@PLATFORM_VERSION@[\s]*[a-zA-Z0-9\(\)\s:]*$"
      reg_key	:	"HKLM\Software\Microsoft\Windows Nt\Currentversion"
      reg_item	:	"ProductName"
      check_type	:	"CHECK_REGEX"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "DISA_STIG_Microsoft_Windows_Server_2022_v1r3.audit from DISA Microsoft Windows Server 2022 v1r3 STIG"
      info        : "Nessus has identified that Windows Server 2022 is installed."
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Server_2022_V1R3_STIG.zip"
    </report>

    <report type:"WARNING">
      description : "WN22-00-000010 - Windows Server 2022 users with Administrative privileges must have separate accounts for administrative duties and normal operational tasks."
      info        : "Using a privileged account to perform routine functions makes the computer vulnerable to malicious software inadvertently introduced during a session that has been granted full privileges.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Ensure each user with administrative privileges has a separate account for user duties and one for privileged duties."
      reference   : "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|MS_Windows_Server_2022_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-254238r848530_rule,STIG-ID|WN22-00-000010,SWIFT-CSCv1|2.3,Vuln-ID|V-254238"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Server_2022_V1R3_STIG.zip"
    </report>

    <custom_item>
      type	:	"TEST"
      description	:	"TEST"
      info	:	"TEST"
      solution	:	"TEST"
      reference	:	"800-171|3.5.2,800-53|IA-5(1)(d),800-53r5|IA-5(1)(d),CAT|II,CCI|CCI-000199,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,DISA_Benchmark|MS_Windows_Server_2022_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(d),NESA|T5.2.3,NIAv2|AM20,NIAv2|AM21,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-254239r915618_rule,STIG-ID|WN22-00-000020,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.2,Vuln-ID|V-254239"
      see_also	:	"TEST"
      value_type	:	"TEST"
      value_data	:	"TEST"
      powershell_args	:	"TEST"
    </custom_item>

    <report type:"WARNING">
      description : "WN22-00-000030 - Windows Server 2022 administrative accounts must not be used with applications that access the internet, such as web browsers, or with potential internet sources, such as email."
      info        : "Using applications that access the internet or have potential internet sources using administrative privileges exposes a system to compromise. If a flaw in an application is exploited while running as a privileged user, the entire system could be compromised. Web browsers and email are common attack vectors for introducing malicious code and must not be run with an administrative account.

Since administrative accounts may generally change or work around technical restrictions for running a web browser or other applications, it is essential that policy require administrative accounts to not access the internet or use applications such as email.

The policy must define specific exceptions for local service administration. These exceptions may include HTTP(S)-based tools that are used for the administration of the local system, services, or attached devices.

Whitelisting can be used to enforce the policy to ensure compliance.

Satisfies: SRG-OS-000480-GPOS-00227, SRG-OS-000205-GPOS-00083

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Establish a policy, at minimum, to prohibit administrative accounts from using applications that access the internet, such as web browsers, or with potential internet sources, such as email. Ensure the policy is enforced.

The organization may use technical means such as whitelisting to prevent the use of browsers and mail applications to enforce this requirement."
      reference   : "800-171|3.4.2,800-53|CM-6b.,800-53|SI-11a.,800-53r5|CM-6b.,800-53r5|SI-11a.,CAT|I,CCI|CCI-000366,CCI|CCI-001312,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|MS_Windows_Server_2022_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,ITSG-33|SI-11b.,NESA|T3.2.1,Rule-ID|SV-254240r848536_rule,STIG-ID|WN22-00-000030,SWIFT-CSCv1|2.3,Vuln-ID|V-254240"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Server_2022_V1R3_STIG.zip"
    </report>

    <custom_item>
      type	:	"AUDIT_POWERSHELL"
      description	:	"WN22-00-000040 - Windows Server 2022 members of the Backup Operators group must have separate accounts for backup duties and normal operational tasks."
      info	:	"Backup Operators are able to read and write to any file in the system, regardless of the rights assigned to it. Backup and restore rights permit users to circumvent the file access restrictions present on NTFS disk drives for backup and restore purposes. Members of the Backup Operators group must have separate logon accounts for performing backup duties.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution	:	"Ensure each member of the Backup Operators group has separate accounts for backup functions and standard user functions."
      reference	:	"800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|MS_Windows_Server_2022_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-254241r848539_rule,STIG-ID|WN22-00-000040,SWIFT-CSCv1|2.3,Vuln-ID|V-254241"
      see_also	:	"https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Server_2022_V1R3_STIG.zip"
      value_type	:	"POLICY_TEXT"
      value_data	:	"MANUAL REVIEW"
      powershell_args	:	"'$obj_group = [ADSI]\'WinNT://localhost/Backup Operators,group\'; \'BACKUP OPERATORS:\'; @($obj_group.psbase.Invoke(\'Members\')) | foreach{ ([ADSI]$_).InvokeGet(\'Name\') };'"
      severity	:	"MEDIUM"
    </custom_item>

    <report type:"WARNING">
      description : "WN22-00-000050 - Windows Server 2022 manually managed application account passwords must be at least 15 characters in length."
      info        : "Application/service account passwords must be of sufficient length to prevent being easily cracked. Application/service accounts that are manually managed must have passwords at least 15 characters in length.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Establish a policy that requires application/service account passwords that are manually managed to be at least 15 characters in length. Ensure the policy is enforced."
      reference   : "800-171|3.5.7,800-53|IA-5(1)(a),800-53r5|IA-5(1)(a),CAT|II,CCI|CCI-000205,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,DISA_Benchmark|MS_Windows_Server_2022_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-254242r848542_rule,STIG-ID|WN22-00-000050,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4,Vuln-ID|V-254242"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Server_2022_V1R3_STIG.zip"
    </report>
  </then>
</if>